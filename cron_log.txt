Conexión exitosa a PostgreSQL
Consulta: 'drop table if exists analitica.dou_tabla_final_tiempos'  ejecutada correctamente.
No se encontró el archivo: static/Querys/manufactura1.txt
Traceback (most recent call last):
  File "/home/david/reporteriaUG/reporteriaUG/reporteria.py", line 64, in <module>
    ejecutar_consulta(conexion,consulta)
  File "/home/david/reporteriaUG/reporteriaUG/reporteria.py", line 46, in ejecutar_consulta
    cursor.execute(consulta)
psycopg2.ProgrammingError: can't execute an empty query
Conexión exitosa a PostgreSQL
Consulta: 'drop table if exists analitica.dou_tabla_final_tiempos'  ejecutada correctamente.
Consulta: 'create table analitica.dou_tabla_final_tiempos as

with cruce_p as (
    select
    t1.name as orden_pdc,
    t1.origin,
    t1.project_id,
    t1.state,
    t1.date_start_per,
    TO_CHAR(t1.date_start_per, 'YYYY-MM') AS mes_inicio,
    (t1.date_start_per >= CURRENT_DATE - INTERVAL '7 days' AND t1.date_start <= CURRENT_DATE) AS iniciado_semana,    
    t1.date_finished,
    TO_CHAR(t1.date_finished, 'YYYY-MM') AS mes_fin,
    (t1.date_finished >= CURRENT_DATE - INTERVAL '7 days' AND t1.date_finished <= CURRENT_DATE) AS terminado_semana,      
    t1.create_date,
    TO_CHAR(t1.create_date, 'YYYY-MM') AS mes_creacion,
    (t1.create_date >= CURRENT_DATE - INTERVAL '7 days' AND t1.create_date <= CURRENT_DATE) AS creado_semana,                    
    t1.sale_order_id,
    t2.name as nombre_fabricante,
    case 
        when t1.product_id = 41  then 'FREIDORA'
        else upper(t4.name->>'es_ES')
    end  as producto,
    t4.tipo_proceso as tipo_producto,
    working_hours_diff(t1.date_start_per, t1.date_finished) as horas_fabricacion,
    working_hours_diff(t1.create_date, t1.date_start_per) as horas_crea_ini,
    case
        when lower(t4.name->>'es_ES') like '%base%chef%' then 'Base Chef'
        when lower(t4.name->>'es_ES') like '%baño%maria%' then 'Baño María'
        when lower(t4.name->>'es_ES') like '%campana%' then 'Campana'
        when lower(t4.name->>'es_ES') like '%carcamo%' then 'Cárcamo'
        when lower(t4.name->>'es_ES') like '%congelador%' then 'Congelador'
        when lower(t4.name->>'es_ES') like '%escurridor%loza%' then 'Escurridor Loza'
        when lower(t4.name->>'es_ES') like '%estacion%licuado%' then 'Estación de Licuado'
        when lower(t4.name->>'es_ES') like '%estacion%bar%' then 'Estación de Bar'
        when lower(t4.name->>'es_ES') like '%estanteria%industrial%' then 'Estantería industrial'
        when lower(t4.name->>'es_ES') like '%estufa%' then 'Estufa'
        when lower(t4.name->>'es_ES') like '%freidora%' then 'Freidora'
        when lower(t4.name->>'es_ES') like '%lavado%manos%' then 'Lavado de Manos'
        when lower(t4.name->>'es_ES') like '%mesa%auxiliar%' then 'Mesa Auxiliar'
        when lower(t4.name->>'es_ES') like '%mesa%lavado%' then 'Mesa de Lavado' 
        when lower(t4.name->>'es_ES') like '%mesa%isla%' then 'Mesa en Isla'
        when lower(t4.name->>'es_ES') like '%lava%traperos%' then 'Lava Traperos'
        when lower(t4.name->>'es_ES') like '%mesa%trabajo%' then 'Mesa de Trabajo'
        when lower(t4.name->>'es_ES') like '%mesa%apoyo%' then 'Mesa de Apoyo'
        when lower(t4.name->>'es_ES') like '%modulo%mixto%gas%' then 'Módulo Mixto de Cocción' 
        when lower(t4.name->>'es_ES') like '%mueble%' then 'Mueble (Carpintería)'
        when lower(t4.name->>'es_ES') like '%nevera%' then 'Nevera/Refrigerador'
        when lower(t4.name->>'es_ES') like '%refrigerador%' then 'Nevera/Refrigerador'
        when lower(t4.name->>'es_ES') like '%parrilla%' then 'Parrilla'
        when lower(t4.name->>'es_ES') like '%plancha%' then 'Plancha'
        when lower(t4.name->>'es_ES') like '%punto%pago%' then 'Punto de Pago'
        when lower(t4.name->>'es_ES') like '%repisa%' then 'Repisa'
        when lower(t4.name->>'es_ES') like '%vertical%mixta%' then 'Nevera/Refrigerador'
        when lower(t4.name->>'es_ES') like '%vitrina%' then 'Vitrina'                         
        when lower(t4.name->>'es_ES') like '%cava%' then 'Cava'
        when t1.product_id = 41  then 'Freidora'
        else 'Otro Carpintería'
    end as familia_producto
    from mrp_production t1
    left join hr_employee t2 on t1.employee_id=t2.id
    left join product_product t3 ON t1.product_id = t3.id
    left join product_template t4 ON t3.product_tmpl_id = t4.id
    where tipo_proceso <> 'log' 
)
select * from cruce_p

 '  ejecutada correctamente.
Consulta: 'drop table if exists analitica.dou_resumen_equipos_proyectos'  ejecutada correctamente.
Consulta: 'create table analitica.dou_resumen_equipos_proyectos as
with cruce as (
    select
     case 
        when t3.id <> 19 then t3.name->>'es_ES'
        else t3.name->>'es_CO'
     end as proyecto
    ,t1.order_id
    ,t1.product_id
    ,case 
        when t1.product_id = 41 then 'FREIDORA'
        else REPLACE(REPLACE(upper(t1.name), E'\r', ' '), E'\n', ' ')
    end as equipo,
    case when t3.info_iva = 'Proyecto con IVA'  then round(t1.price_total/1.19)
     else t1.price_total
    end as precio_sin_iva
    ,case
    when lower(t4.name->>'es_ES') not like '%ducteria%' then t1.product_uom_qty
    else 1
    end as cantidad
    ,t4.producto_tercerizado
    ,t4.tipo_proceso
    ,    case
            when lower(t4.name->>'es_ES') like '%base%chef%' then 'Base Chef'
            when lower(t4.name->>'es_ES') like '%baño%maria%' then 'Baño María'
            when lower(t4.name->>'es_ES') like '%campana%' then 'Campana'
            when lower(t4.name->>'es_ES') like '%carcamo%' then 'Cárcamo'
            when lower(t4.name->>'es_ES') like '%congelador%' then 'Congelador'
            when lower(t4.name->>'es_ES') like '%escurridor%loza%' then 'Escurridor Loza'
            when lower(t4.name->>'es_ES') like '%estacion%licuado%' then 'Estación de Licuado'
            when lower(t4.name->>'es_ES') like '%estacion%bar%' then 'Estación de Bar'
            when lower(t4.name->>'es_ES') like '%estanteria%industrial%' then 'Estantería industrial'
            when lower(t4.name->>'es_ES') like '%estufa%' then 'Estufa'
            when lower(t4.name->>'es_ES') like '%freidora%' then 'Freidora'
            when lower(t4.name->>'es_ES') like '%lavado%manos%' then 'Lavado de Manos'
            when lower(t4.name->>'es_ES') like '%mesa%auxiliar%' then 'Mesa Auxiliar'
            when lower(t4.name->>'es_ES') like '%mesa%lavado%' then 'Mesa de Lavado' 
            when lower(t4.name->>'es_ES') like '%mesa%isla%' then 'Mesa en Isla'
            when lower(t4.name->>'es_ES') like '%lava%traperos%' then 'Lava Traperos'
            when lower(t4.name->>'es_ES') like '%mesa%trabajo%' then 'Mesa de Trabajo'
            when lower(t4.name->>'es_ES') like '%mesa%apoyo%' then 'Mesa de Apoyo'
            when lower(t4.name->>'es_ES') like '%modulo%mixto%gas%' then 'Módulo Mixto de Cocción' 
            when lower(t4.name->>'es_ES') like '%mueble%' then 'Mueble (Carpintería)'
            when lower(t4.name->>'es_ES') like '%nevera%' then 'Nevera/Refrigerador'
            when lower(t4.name->>'es_ES') like '%refrigerador%' then 'Nevera/Refrigerador'
            when lower(t4.name->>'es_ES') like '%parrilla%' then 'Parrilla'
            when lower(t4.name->>'es_ES') like '%plancha%' then 'Plancha'
            when lower(t4.name->>'es_ES') like '%punto%pago%' then 'Punto de Pago'
            when lower(t4.name->>'es_ES') like '%repisa%' then 'Repisa'
            when lower(t4.name->>'es_ES') like '%vertical%mixta%' then 'Nevera/Refrigerador'
            when lower(t4.name->>'es_ES') like '%vitrina%' then 'Vitrina'                         
            when lower(t4.name->>'es_ES') like '%campana%' then 'Campana'
            when lower(t4.name->>'es_ES') like '%cava%' then 'Cava'
            when lower(t4.name->>'es_ES') like '%ducteria%' then 'Ductería'
            when lower(t4.name->>'es_ES') like '%motor%' then 'Motor'
            when lower(t4.name->>'es_ES') like '%arrancador%' then 'Arrancador'
            when lower(t4.name->>'es_ES') like '%turbina%' then 'Turbina'
            when lower(t4.name->>'es_ES') like '%variador%' then 'Variador'
            when lower(t4.name->>'es_ES') like '%logistica%' then 'Logística y Transporte'       
            when t4.id = 41  then 'Freidora'
            else 'Otro Carpintería'
        end as familia_producto
    ,TO_CHAR(t3.create_date, 'YYYY-MM') as fecha_creacion
    ,TO_CHAR(t3.create_date, 'YYYY') as anio
    from sale_order_line t1 
    inner join sale_order t2 on t1.order_id = t2.id
    inner join project_project t3 on t2.project_id = t3.id
    left join product_template t4 on t1.product_id = t4.id
    where t2.state = 'sale'
)
select *, (precio_sin_iva/cantidad) as precio_unitario from cruce'  ejecutada correctamente.
